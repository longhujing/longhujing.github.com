<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>楠枫 - nanfeng</title><meta name="author" content="楠枫"><meta name="copyright" content="楠枫"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="description" content="南风未起，念你成疾">
<meta property="og:type" content="website">
<meta property="og:title" content="楠枫">
<meta property="og:url" content="https://longhujing.github.io/index.html">
<meta property="og:site_name" content="楠枫">
<meta property="og:description" content="南风未起，念你成疾">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/longhujing/assert/img/20201007005611.jpg">
<meta property="article:author" content="楠枫">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/longhujing/assert/img/20201007005611.jpg"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/longhujing/assert/img/20201007011027.ico"><link rel="canonical" href="https://longhujing.github.io/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="2mKW6DRTtPiHuxKWzKYmIhFA5e9t0m5KRhsU5I8oV4k"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script async="async" src="https://www.googletagmanager.com/gtag/js?id=UA-180135822-1"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-180135822-1');
</script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: 楠枫","link":"链接: ","source":"来源: 楠枫","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: true
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}

// https://stackoverflow.com/questions/16839698/jquery-getscript-alternative-in-native-javascript
const getScript = url => new Promise((resolve, reject) => {
  const script = document.createElement('script')
  script.src = url
  script.async = true
  script.onerror = reject
  script.onload = script.onreadystatechange = function() {
    const loadState = this.readyState
    if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
    script.onload = script.onreadystatechange = null
    resolve()
  }
  document.head.appendChild(script)
})</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: false,
  isHome: true,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2021-01-17 00:31:40'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(function () {  window.activateDarkMode = function () {
    document.documentElement.setAttribute('data-theme', 'dark')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
    }
  }
  window.activateLightMode = function () {
    document.documentElement.setAttribute('data-theme', 'light')
   if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
    }
  }
  const autoChangeMode = 'false'
  const t = saveToLocal.get('theme')
  if (autoChangeMode === '1') {
    const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
    const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
    const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
    const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified
    if (t === undefined) {
      if (isLightMode) activateLightMode()
      else if (isDarkMode) activateDarkMode()
      else if (isNotSpecified || hasNoSupport) {
        const now = new Date()
        const hour = now.getHours()
        const isNight = hour <= 6 || hour >= 18
        isNight ? activateDarkMode() : activateLightMode()
      }
      window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
        if (saveToLocal.get('theme') === undefined) {
          e.matches ? activateDarkMode() : activateLightMode()
        }
      })
    } else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else if (autoChangeMode === '2') {
    const now = new Date()
    const hour = now.getHours()
    const isNight = hour <= 6 || hour >= 18
    if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
    else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else {
    if (t === 'dark') activateDarkMode()
    else if (t === 'light') activateLightMode()
  }const asideStatus = saveToLocal.get('aside-status')
if (asideStatus !== undefined) {
   if (asideStatus === 'hide') {
     document.documentElement.classList.add('hide-aside')
   } else {
     document.documentElement.classList.remove('hide-aside')
   }
}})()</script><meta name="referrer" content="no-referrer-when-downgrade" /><meta name="baidu-site-verification" content="code-MRYTs2s4ta" /><meta name="generator" content="Hexo 5.2.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" data-lazy-src="https://cdn.jsdelivr.net/gh/longhujing/assert/img/20201007005611.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">24</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">25</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">15</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><div class="page" id="body-wrap"><header class="full_page" id="page-header" style="background-image: url(https://i.loli.net/2020/10/07/3yeotb1YU6k7Vgl.png)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">楠枫</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="site-info"><h1 id="site-title">楠枫</h1><div id="site-subtitle"><span id="subtitle"></span></div><div id="site_social_icons"><a class="social-icon" href="https://github.com/longhujing" rel="external nofollow noreferrer" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:lhj8023@outlook.com" rel="external nofollow noreferrer" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div id="scroll-down"><i class="fas fa-angle-down scroll-down-effects"></i></div></header><main class="layout" id="content-inner"><div class="recent-posts" id="recent-posts"><div class="recent-post-item"><div class="post_cover left_radius"><a href="/2021/01/10/d64754c3.html" title="内存可见性问题">     <img class="post_bg" data-lazy-src="https://i.loli.net/2020/10/07/3yeotb1YU6k7Vgl.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="内存可见性问题"></a></div><div class="recent-post-info"><a class="article-title" href="/2021/01/10/d64754c3.html" title="内存可见性问题">内存可见性问题</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-01-10T15:06:05.000Z" title="发表于 2021-01-10 23:06:05">2021-01-10</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox article-meta__icon"></i><a class="article-meta__categories" href="/categories/%E5%B9%B6%E5%8F%91/">并发</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fas fa-tag article-meta__icon"></i><a class="article-meta__tags" href="/tags/%E5%8F%AF%E8%A7%81%E6%80%A7/">可见性</a><span class="article-meta__link">•</span><a class="article-meta__tags" href="/tags/%E5%B9%B6%E5%8F%91/">并发</a></span></div><div class="content">内存可见性是指：一个线程正在使用的对象状态被别的线程修改后，该线程要能够立刻感知到这种变化。


一个简单的内存可见性的例子
1234567891011121314151617181920212223public class Demo &#123;    private static boolean stop = false;    public static void main(String[] args) throws InterruptedException &#123;        Demo demo = new Demo();        new Thread(demo::visibleTest).start();        // 防止太快导致子线程还没有进入运行态状态就被修改        Thread.sleep(100);        stop = true;        while (true) &#123;            // wait        &#125;    &#125;    public void visibleTest() &# ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/2021/01/05/6e774499.html" title="synchronized实现原理">     <img class="post_bg" data-lazy-src="https://cdn.jsdelivr.net/gh/longhujing/assert/img/20210110003237.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="synchronized实现原理"></a></div><div class="recent-post-info"><a class="article-title" href="/2021/01/05/6e774499.html" title="synchronized实现原理">synchronized实现原理</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-01-05T15:34:11.000Z" title="发表于 2021-01-05 23:34:11">2021-01-05</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox article-meta__icon"></i><a class="article-meta__categories" href="/categories/%E9%94%81/">锁</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fas fa-tag article-meta__icon"></i><a class="article-meta__tags" href="/tags/%E9%94%81/">锁</a><span class="article-meta__link">•</span><a class="article-meta__tags" href="/tags/synchronized/">synchronized</a></span></div><div class="content">
最近在学习并发相关的内容，学完以后深感面试那一套还是太水了，没有深度和自己的理解

从目的说起为什么需要使用synchronized? 加了synchronized后有什么不同?
12345678910111213141516171819public class Demo &#123;        private static int count = 0;        public static void main(String[] args) throws Exception &#123;        for(int i = 0; i &lt; 10; i++) &#123;            new Thread(() -&gt; increase()).start();        &#125;        Thread.sleep(5000);        System.out.println(count);    &#125;        private static void increase() &#123;        for(int i = 0; ...</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/2020/12/24/d9a0e3ef.html" title="RocketMQ集群搭建(双主双从)">     <img class="post_bg" data-lazy-src="https://cdn.jsdelivr.net/gh/longhujing/assert/img/20201224020844.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="RocketMQ集群搭建(双主双从)"></a></div><div class="recent-post-info"><a class="article-title" href="/2020/12/24/d9a0e3ef.html" title="RocketMQ集群搭建(双主双从)">RocketMQ集群搭建(双主双从)</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2020-12-23T16:42:27.000Z" title="发表于 2020-12-24 00:42:27">2020-12-24</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox article-meta__icon"></i><a class="article-meta__categories" href="/categories/RocketMQ/">RocketMQ</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fas fa-tag article-meta__icon"></i><a class="article-meta__tags" href="/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/">消息队列</a><span class="article-meta__link">•</span><a class="article-meta__tags" href="/tags/RocketMQ/">RocketMQ</a></span></div><div class="content">本文采用当前RocketMQ最新版本4.8.0，采用两台虚拟机搭建双主双从RocketMQ集群
整体架构如图

环境准备
两台CentOS7虚拟机

下载RocketMQ-4.8.0安装包点击下载

JDK安装


开始安装
解压RocketMQ安装包
123unzip rocketmq-all-4.8.0-bin-release.zip# 如果提示找不到unzip命令，可以通过 yum install unzip 安装

移动RocketMQ安装包到/usr/local/rocketmq
12mkdir /usr/local/rocketmqmv rocketmq-all-4.8.0-bin-release /usr/local/rocketmq

由于采用的是双主双从模式，因此需要修改/usr/local/rocketmq/conf/2m-2s-async中的几个文件

clusterServer1 - 192.168.3.144 - broker-a.properties
123456789101112131415161718192021222324252627282930313 ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/2020/12/15/3e803f5.html" title="为什么使用消息队列">     <img class="post_bg" data-lazy-src="https://i.loli.net/2020/10/07/3yeotb1YU6k7Vgl.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="为什么使用消息队列"></a></div><div class="recent-post-info"><a class="article-title" href="/2020/12/15/3e803f5.html" title="为什么使用消息队列">为什么使用消息队列</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2020-12-14T16:01:05.000Z" title="发表于 2020-12-15 00:01:05">2020-12-15</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox article-meta__icon"></i><a class="article-meta__categories" href="/categories/MQ/">MQ</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fas fa-tag article-meta__icon"></i><a class="article-meta__tags" href="/tags/MQ/">MQ</a></span></div><div class="content">使用消息队列当然是因为它能够带来一些好处，或者说消息队列在一些场景中，能够给系统的性能带来一定的提升
总体来说，消息队列的好处主要是: 解耦、异步、削峰
解耦在不使用消息队列的时候系统可能是这样的:

用户在访问系统A时，系统A需要依次调用系统B、C、D才能处理完数据，系统之间耦合度较高，这样带来的一个后果就是，当业务发生变动，例如新增新的系统或者移除系统时，修改起来就是伤筋动骨。

将系统D移除以后，又新增系统E和系统F，这样一来改动整个逻辑就会非常的复杂，维护成本很高。
使用消息队列以后就会简单很多: 

使用消息队列以后，系统A只需要将消息交给消息队列，其它的系统如果有需要就自己到消息队列获取消息处理，如果不需要了就断开和消息队列的联系即可，系统之间的耦合度降低，维护成本也降低了。
异步说异步要先说同步，同步就是等待一件事完成以后再去做另一件事，例如要完成的事情是洗衣服、烧水、打游戏，总不会有人要先等衣服洗完了再去烧水，水烧好了再去打游戏吧….
一般而言都是衣服丢到洗衣机洗，然后烧水交给热水壶做，接着边打游戏便等待，这就是异步。
你会发现使用异步处理这三件事情的时候耗时不高，但是 ...</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/2020/12/13/34c8df5d.html" title="MySQL分析工具-Explain">     <img class="post_bg" data-lazy-src="http://longhujing.gitee.io/image-bed/resources/images/install-mysql/mysql-0.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MySQL分析工具-Explain"></a></div><div class="recent-post-info"><a class="article-title" href="/2020/12/13/34c8df5d.html" title="MySQL分析工具-Explain">MySQL分析工具-Explain</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2020-12-13T11:01:18.000Z" title="发表于 2020-12-13 19:01:18">2020-12-13</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox article-meta__icon"></i><a class="article-meta__categories" href="/categories/MySQL/">MySQL</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fas fa-tag article-meta__icon"></i><a class="article-meta__tags" href="/tags/MySQL/">MySQL</a></span></div><div class="content">
MySQL服务器在接收到SQL指令之后，对其进行解析会生成一个执行计划，通过Explain关键字就可以看到具体的执行计划是怎样的，从而有针对性的去优化SQL

数据准备12345678910111213141516171819202122232425262728293031323334353637-- 学生信息表CREATE TABLE ex_student (     id BIGINT NOT NULL PRIMARY KEY AUTO_INCREMENT,     NAME VARCHAR ( 32 ) NOT NULL,     student_number VARCHAR ( 32 ) NOT NULL );-- 老师信息表CREATE TABLE ex_teacher (     id BIGINT NOT NULL PRIMARY KEY AUTO_INCREMENT,     NAME VARCHAR ( 32 ) NOT NULL,     teacher_number VARCHAR ( 32 ) NOT NULL );-- 科目表CREATE TABLE ex_ ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/2020/12/10/a64ce2f7.html" title="SpringBoot线程池使用">     <img class="post_bg" data-lazy-src="https://cdn.jsdelivr.net/gh/longhujing/assert/img/20201209011430.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SpringBoot线程池使用"></a></div><div class="recent-post-info"><a class="article-title" href="/2020/12/10/a64ce2f7.html" title="SpringBoot线程池使用">SpringBoot线程池使用</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2020-12-09T16:36:00.000Z" title="发表于 2020-12-10 00:36:00">2020-12-10</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox article-meta__icon"></i><a class="article-meta__categories" href="/categories/SpringBoot/">SpringBoot</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fas fa-tag article-meta__icon"></i><a class="article-meta__tags" href="/tags/SpringBoot/">SpringBoot</a><span class="article-meta__link">•</span><a class="article-meta__tags" href="/tags/%E7%BA%BF%E7%A8%8B%E6%B1%A0/">线程池</a></span></div><div class="content">工作中有很多的场景很有必要做异步处理，如更新啥啥啥又不需要即时显示的那种、导入数据、生成报表等等之类的不耗时又不需要即时显示的场景。
SpringBoot默认线程池
In the absence of an Executor bean in the context, Spring Boot auto-configures a ThreadPoolTaskExecutor with sensible defaults that can be automatically associated to asynchronous task execution (@EnableAsync) and Spring MVC asynchronous request processing.

这段话简单来说就是SpringBoot已经内置了一个ThreadPoolTaskExecutor了，如果不主动去创建这个线程池，那么就会给你默认创建一个出来，直接拿来用就可以了。比如像这样
123456@Autowiredprivate ThreadPoolTaskExecutor threadPoolTaskEx ...</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/2020/12/09/9c514b92.html" title="SpringBoot 跨域问题解决">     <img class="post_bg" data-lazy-src="https://cdn.jsdelivr.net/gh/longhujing/assert/img/20201209011430.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SpringBoot 跨域问题解决"></a></div><div class="recent-post-info"><a class="article-title" href="/2020/12/09/9c514b92.html" title="SpringBoot 跨域问题解决">SpringBoot 跨域问题解决</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2020-12-08T16:15:51.000Z" title="发表于 2020-12-09 00:15:51">2020-12-09</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox article-meta__icon"></i><a class="article-meta__categories" href="/categories/SpringBoot/">SpringBoot</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fas fa-tag article-meta__icon"></i><a class="article-meta__tags" href="/tags/SpringBoot/">SpringBoot</a><span class="article-meta__link">•</span><a class="article-meta__tags" href="/tags/%E8%B7%A8%E5%9F%9F/">跨域</a></span></div><div class="content">前后端分离开发模式下，不可避免的就会出现跨域的问题。
什么是跨域URL通常由以下几个部分组成
协议 + 域名 + 端口号 + 资源路径
例如https://www.baidu.com/search?keyword=abc
就是由https + www.baidu.com + 80 + /search这四个部分组成，其中端口号80是默认的，就不显示出来了。如果两个URL中的四个部分有任意一个部分不相同，那么就会出现跨域问题。
跨域亲身体会编写一个简单的Java Web服务
123456789@RestControllerpublic class TestController &#123;    @GetMapping(value = &quot;/test1&quot;)    public String test1() &#123;        return &quot;Hello World...1&quot;;    &#125;&#125;

启动项目，浏览器输入http://localhost:8080/test1可以看到打印出Hello World...1
接下来，打开任意 ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/2020/12/08/d7ec223d.html" title="Redis Desktop Manager最新版分享（持续更新）">     <img class="post_bg" data-lazy-src="https://cdn.jsdelivr.net/gh/longhujing/assert/img/20201209001248.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Redis Desktop Manager最新版分享（持续更新）"></a></div><div class="recent-post-info"><a class="article-title" href="/2020/12/08/d7ec223d.html" title="Redis Desktop Manager最新版分享（持续更新）">Redis Desktop Manager最新版分享（持续更新）</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2020-12-07T18:17:30.000Z" title="发表于 2020-12-08 02:17:30">2020-12-08</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox article-meta__icon"></i><a class="article-meta__categories" href="/categories/%E5%B7%A5%E5%85%B7/">工具</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fas fa-tag article-meta__icon"></i><a class="article-meta__tags" href="/tags/%E5%B7%A5%E5%85%B7/">工具</a><span class="article-meta__link">•</span><a class="article-meta__tags" href="/tags/Redis-Desktop-Manager/">Redis Desktop Manager</a></span></div><div class="content">Redis Desktop Manager 2020本文仅提供Redis Desktop Manager工具下载方式，如有侵权，请联系作者删除


WindowsRedis Desktop Manager 2020.0点击下载
Redis Desktop Manager 2020.1点击下载
Redis Desktop Manager 2020.2点击下载
Redis Desktop Manager 2020.3点击下载
Redis Desktop Manager 2020.4点击下载
Redis Desktop Manager 2020.5点击下载
Redis Desktop Manager 2020.6点击下载
MacOSRedis Desktop Manager点击下载
</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/2020/12/07/cc3990f2.html" title="Git只提交某一次的Commit">     <img class="post_bg" data-lazy-src="https://cdn.jsdelivr.net/gh/longhujing/assert/img/20201207232741.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Git只提交某一次的Commit"></a></div><div class="recent-post-info"><a class="article-title" href="/2020/12/07/cc3990f2.html" title="Git只提交某一次的Commit">Git只提交某一次的Commit</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2020-12-07T15:25:52.000Z" title="发表于 2020-12-07 23:25:52">2020-12-07</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox article-meta__icon"></i><a class="article-meta__categories" href="/categories/Git/">Git</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fas fa-tag article-meta__icon"></i><a class="article-meta__tags" href="/tags/Git/">Git</a></span></div><div class="content">
写代码有的时候会出现这样一种情况：前面已经commit了一大堆东西，但是突然有个修复需要紧急提交一下，而且又不想把前面的commit一起push，那要怎么搞哦

如图

我现在有以下几个Commit，然后我想要优先提交Commit信息为[modify][初始化项目]的这个提交，那么仅需要获取到这个提交的提交号，然后提交就好了，具体操作如下：
123456789101112131415161718192021222324252627git log// ...commit 97eaf382227e744680e7de886d31293133b04308 (HEAD -&gt; master)Author: LHJ &lt;lhj8023@outlook.com&gt;Date:   Mon Dec 7 23:34:15 2020 +0800    [modify][添加RedissonRMap测试类]commit 578a3780f37df461aab44d94aedfb15ad67cf71dAuthor: LHJ &lt;lhj8023@outlook.com&gt;Date:   M ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/2020/12/06/6dd39ea8.html" title="Redisson爬坑之RMap">     <img class="post_bg" data-lazy-src="https://cdn.jsdelivr.net/gh/longhujing/assert/img/20201207003918.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Redisson爬坑之RMap"></a></div><div class="recent-post-info"><a class="article-title" href="/2020/12/06/6dd39ea8.html" title="Redisson爬坑之RMap">Redisson爬坑之RMap</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2020-12-06T15:23:04.000Z" title="发表于 2020-12-06 23:23:04">2020-12-06</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox article-meta__icon"></i><a class="article-meta__categories" href="/categories/Redisson/">Redisson</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fas fa-tag article-meta__icon"></i><a class="article-meta__tags" href="/tags/Redisson/">Redisson</a></span></div><div class="content">
最近在使用Redisson操作Hash数据结构的时候出现了很多的坑，特此记录下来。

场景描述因为数据库表里面有2000w+的数据量，而业务里面查询这个表的时候有一个group by的操作无法走到联合索引，会造成非常大的延时（20s+），因此有必要先缓存一个月的数据在Redis中。按照目前的情况预估大概是有不到10个key，每个key有6000+的field，而且读取的时候需要一次把一个key下的所有field全部读出来。
神坑操作1234private List&lt;String&gt; getAllRecordFromCache(String key) &#123;    RMap&lt;String, String&gt; recordMap = redissonClient.getMap(key);    return Lists.newArrayList(recordMap.values());&#125;

乍一看似乎没啥子问题，但是点进去这个recordMap.values()方法里面一看，最后是定位到这个地方来了
1234567891011121314151617f ...</div></div></div><nav id="pagination"><div class="pagination"><span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fas fa-chevron-right fa-fw"></i></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" data-lazy-src="https://cdn.jsdelivr.net/gh/longhujing/assert/img/20201007005611.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">楠枫</div><div class="author-info__description">南风未起，念你成疾</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">24</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">25</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">15</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/longhujing"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/longhujing" rel="external nofollow noreferrer" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:lhj8023@outlook.com" rel="external nofollow noreferrer" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">南风未起，念你成疾</div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2021/01/10/d64754c3.html" title="内存可见性问题"><img data-lazy-src="https://i.loli.net/2020/10/07/3yeotb1YU6k7Vgl.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="内存可见性问题"/></a><div class="content"><a class="title" href="/2021/01/10/d64754c3.html" title="内存可见性问题">内存可见性问题</a><time datetime="2021-01-10T15:06:05.000Z" title="发表于 2021-01-10 23:06:05">2021-01-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/01/05/6e774499.html" title="synchronized实现原理"><img data-lazy-src="https://cdn.jsdelivr.net/gh/longhujing/assert/img/20210110003237.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="synchronized实现原理"/></a><div class="content"><a class="title" href="/2021/01/05/6e774499.html" title="synchronized实现原理">synchronized实现原理</a><time datetime="2021-01-05T15:34:11.000Z" title="发表于 2021-01-05 23:34:11">2021-01-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2020/12/24/d9a0e3ef.html" title="RocketMQ集群搭建(双主双从)"><img data-lazy-src="https://cdn.jsdelivr.net/gh/longhujing/assert/img/20201224020844.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="RocketMQ集群搭建(双主双从)"/></a><div class="content"><a class="title" href="/2020/12/24/d9a0e3ef.html" title="RocketMQ集群搭建(双主双从)">RocketMQ集群搭建(双主双从)</a><time datetime="2020-12-23T16:42:27.000Z" title="发表于 2020-12-24 00:42:27">2020-12-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2020/12/15/3e803f5.html" title="为什么使用消息队列"><img data-lazy-src="https://i.loli.net/2020/10/07/3yeotb1YU6k7Vgl.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="为什么使用消息队列"/></a><div class="content"><a class="title" href="/2020/12/15/3e803f5.html" title="为什么使用消息队列">为什么使用消息队列</a><time datetime="2020-12-14T16:01:05.000Z" title="发表于 2020-12-15 00:01:05">2020-12-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2020/12/13/34c8df5d.html" title="MySQL分析工具-Explain"><img data-lazy-src="http://longhujing.gitee.io/image-bed/resources/images/install-mysql/mysql-0.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MySQL分析工具-Explain"/></a><div class="content"><a class="title" href="/2020/12/13/34c8df5d.html" title="MySQL分析工具-Explain">MySQL分析工具-Explain</a><time datetime="2020-12-13T11:01:18.000Z" title="发表于 2020-12-13 19:01:18">2020-12-13</time></div></div></div></div><div class="card-widget" id="card-newest-comments"><div class="item-headline"><i class="fas fa-bolt"></i><span>最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div><div class="card-widget card-categories"><div class="item-headline"><i class="fas fa-folder-open"></i><span>分类</span></div><ul class="card-category-list" id="aside-cat-list">
            <li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Git/"><span class="card-category-list-name">Git</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Java/"><span class="card-category-list-name">Java</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Kong/"><span class="card-category-list-name">Kong</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/LeetCode/"><span class="card-category-list-name">LeetCode</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/MQ/"><span class="card-category-list-name">MQ</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/MySQL/"><span class="card-category-list-name">MySQL</span><span class="card-category-list-count">8</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Redisson/"><span class="card-category-list-name">Redisson</span><span class="card-category-list-count">2</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/RocketMQ/"><span class="card-category-list-name">RocketMQ</span><span class="card-category-list-count">1</span></a></li>
            <li class="card-category-list-item more is-center"><a class="card-category-list-link-more" href="/categories/">
                <span>查看更多</span><i class="fas fa-angle-right"></i></a></li>
            </ul></div><div class="card-widget card-tags"><div class="item-headline"><i class="fas fa-tags"></i><span>标签</span></div><div class="card-tag-cloud"><a href="/tags/Git/" style="font-size: 1.1em; color: rgb(173, 153, 48)">Git</a><a href="/tags/MySQL/" style="font-size: 1.5em; color: rgb(143, 29, 183)">MySQL</a><a href="/tags/%E9%94%81/" style="font-size: 1.37em; color: rgb(40, 144, 163)">锁</a><a href="/tags/%E7%BD%91%E5%85%B3/" style="font-size: 1.1em; color: rgb(64, 80, 102)">网关</a><a href="/tags/Kong/" style="font-size: 1.1em; color: rgb(54, 94, 50)">Kong</a><a href="/tags/GitBash/" style="font-size: 1.1em; color: rgb(46, 50, 78)">GitBash</a><a href="/tags/%E4%B8%BB%E9%A2%98/" style="font-size: 1.1em; color: rgb(64, 41, 101)">主题</a><a href="/tags/%E7%B4%A2%E5%BC%95/" style="font-size: 1.1em; color: rgb(131, 53, 166)">索引</a><a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 1.1em; color: rgb(23, 80, 21)">工具</a><a href="/tags/Redis-Desktop-Manager/" style="font-size: 1.1em; color: rgb(131, 193, 89)">Redis Desktop Manager</a><a href="/tags/Redisson/" style="font-size: 1.23em; color: rgb(44, 151, 128)">Redisson</a><a href="/tags/SpringBoot/" style="font-size: 1.37em; color: rgb(157, 59, 124)">SpringBoot</a><a href="/tags/%E8%B7%A8%E5%9F%9F/" style="font-size: 1.1em; color: rgb(155, 58, 16)">跨域</a><a href="/tags/%E4%BC%98%E5%8C%96/" style="font-size: 1.1em; color: rgb(5, 1, 65)">优化</a><a href="/tags/%E7%BA%BF%E7%A8%8B%E6%B1%A0/" style="font-size: 1.1em; color: rgb(44, 187, 36)">线程池</a><a href="/tags/%E6%97%A5%E5%BF%97/" style="font-size: 1.1em; color: rgb(31, 108, 93)">日志</a><a href="/tags/logback/" style="font-size: 1.1em; color: rgb(105, 34, 90)">logback</a><a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 1.23em; color: rgb(80, 167, 182)">算法</a><a href="/tags/MQ/" style="font-size: 1.1em; color: rgb(67, 68, 37)">MQ</a><a href="/tags/synchronized/" style="font-size: 1.1em; color: rgb(36, 162, 67)">synchronized</a><a href="/tags/%E5%8F%AF%E8%A7%81%E6%80%A7/" style="font-size: 1.1em; color: rgb(23, 195, 153)">可见性</a><a href="/tags/%E5%B9%B6%E5%8F%91/" style="font-size: 1.1em; color: rgb(59, 123, 162)">并发</a><a href="/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" style="font-size: 1.1em; color: rgb(98, 146, 24)">消息队列</a><a href="/tags/RocketMQ/" style="font-size: 1.1em; color: rgb(152, 81, 136)">RocketMQ</a><a href="/tags/LeetCode/" style="font-size: 1.1em; color: rgb(49, 14, 44)">LeetCode</a></div></div><div class="card-widget card-archives"><div class="item-headline"><i class="fas fa-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/01/"><span class="card-archive-list-date">一月 2021</span><span class="card-archive-list-count">2</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2020/12/"><span class="card-archive-list-date">十二月 2020</span><span class="card-archive-list-count">9</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2020/11/"><span class="card-archive-list-date">十一月 2020</span><span class="card-archive-list-count">5</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2020/10/"><span class="card-archive-list-date">十月 2020</span><span class="card-archive-list-count">8</span></a></li></ul></div><div class="card-widget card-webinfo"><div class="item-headline"><i class="fas fa-chart-line"></i><span>网站资讯</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">文章数目 :</div><div class="item-count">24</div></div><div class="webinfo-item"><div class="item-name">已运行时间 :</div><div class="item-count" id="runtimeshow" data-publishDate="2020-10-06T16:00:00.000Z"></div></div><div class="webinfo-item"><div class="item-name">本站总字数 :</div><div class="item-count">41.5k</div></div><div class="webinfo-item"><div class="item-name">本站访客数 :</div><div class="item-count" id="busuanzi_value_site_uv"></div></div><div class="webinfo-item"><div class="item-name">本站总访问量 :</div><div class="item-count" id="busuanzi_value_site_pv"></div></div><div class="webinfo-item"><div class="item-name">最后更新时间 :</div><div class="item-count" id="last-push-date" data-lastPushDate="2021-01-16T16:31:39.948Z"></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By 楠枫</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button id="chat_btn" type="button" title="rightside.chat_btn"><i class="fas fa-sms"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.spacingElementById('content-inner')
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.spacingElementById('content-inner')
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',()=> {preloader.endLoading()})</script><div class="js-pjax"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.17.0/js/md5.min.js"></script><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<[^>]+>/g,"") // remove html tag
    content = content.replace(/(http(s?):)([/|.|\w|\s|-])*\.(?:jpg|jpeg|gif|png|webp)/g, '') // remove image link
    content = content.replace(/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gi, '') // remove url

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getIcon = (icon, mail) => {
    if (icon) return icon
    
    let defaultIcon = '?d=monsterid'
    let iconUrl = `https://gravatar.loli.net/avatar/${md5(mail.toLowerCase()) + defaultIcon}`
    return iconUrl
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          let name = 'src'
          if(true) {
            name = 'data-lazy-src'
          }
          result += `<a href='${array[i].url}' class="thumbnail"><img ${name}='${getIcon(array[i].avatar, array[i].mail)}' alt='${array[i].nick}'></a>`
        }

        result += `<div class='content'>
        <a class='comment' href='${array[i].url}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick}</span><time> / ${btf.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom.innerHTML= result
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const getComment = () => {
      let serverURL = ''
      if (false) {
        serverURL = ''
      } else {
        serverURL = 'https://OkELnRgB.api.lncldglobal.com'
      }

    var settings = {
      "method": "GET",
      "headers": {
        "X-LC-Id": 'OkELnRgB1h7xAfUqyViqBNtz-gzGzoHsz',
        "X-LC-Key": '872ccchCi5VbFWO3yXmoRMOk',
        "Content-Type": "application/json"
      },
    }

    fetch(`${serverURL}/1.1/classes/Comment?limit=6&order=-createdAt`,settings)
      .then(response => response.json())
      .then(data => {
        const valineArray = data.results.map(function (e) {
          return {
            'avatar': e.QQAvatar,
            'content': changeContent(e.comment),
            'mail': e.mail,
            'nick': e.nick,
            'url': e.url + '#' + e.objectId,
            'date': e.createdAt,
          }
        })
        saveToLocal.set('leancloud-newest-comments', JSON.stringify(valineArray), 10/(60*24))
        generateHtml(valineArray)
      }).catch(e => {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.innerHTML= "无法获取评论，请确认相关配置是否正确"
      }) 
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('leancloud-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="false"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = [
  'title',
  '#config_change',
  '#body-wrap',
  '#rightside-config-hide',
  '#rightside-config-show',
  '.js-pjax'
]

if (false) {
  pjaxSelectors.unshift('meta[property="og:image"]', 'meta[property="og:title"]', 'meta[property="og:url"]')
}

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: true,
  scrollRestoration: false
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  if (typeof gtag === 'function') {
    gtag('config', 'UA-180135822-1', {'page_path': window.location.pathname});
  }

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // Analytics
  if (false) {
    MtaH5.pgv()
  }

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})


document.addEventListener('pjax:send', function () {
  typeof preloader === 'object' && preloader.initLoading()
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

})</script></div></body></html>